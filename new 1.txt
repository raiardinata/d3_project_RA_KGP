
SELECT CASE WHEN D.MaterialCode IS NOT NULL THEN 'STEP 400'
			   WHEN Z.MaterialCode IS NOT NULL THEN 'STEP 300'
			   WHEN C.MaterialCode IS NOT NULL THEN 'STEP 300'
			   WHEN B.MaterialCode IS NOT NULL THEN 'STEP 200'
			   WHEN A.MaterialCode IS NOT NULL THEN 'STEP 100'
		ELSE 'BIJI KONENG' END AS STEP
, coalesce(D.MaterialCode, z.MaterialCode, c.MaterialCode, b.MaterialCode, a.MaterialCode) SOMAT,
coalesce(D.UUID, z.UUID, c.UUID, b.UUID, a.UUID) SOMATID
, a.UUID U1, a.MaterialCode s1, a.RM_MaterialCode rs1
, B.UUID U2, b.MaterialCode s2, b.RM_MaterialCode rs2
, C.UUID U3, c.MaterialCode s3, c.RM_MaterialCode rs3
, Z.UUID U4, z.MaterialCode s4, z.RM_MaterialCode rs4
, D.UUID U5, d.MaterialCode s5, d.RM_MaterialCode rs5
FROM tbl_transaksi a
LEFT JOIN tbl_transaksi b ON a.MaterialCode = b.MaterialCode AND a.Batch = b.Batch AND b.Step_ID = 200
LEFT JOIN tbl_transaksi c ON c.RM_MaterialCode = b.MaterialCode AND c.RM_Batch = b.Batch AND c.Step_ID = 300
LEFT JOIN tbl_transaksi z ON z.RM_MaterialCode = c.MaterialCode AND z.RM_Batch = c.Batch AND z.Step_ID = 300
LEFT JOIN tbl_transaksi d ON d.MaterialCode = z.MaterialCode AND d.Batch = z.Batch AND d.Step_ID = 400
WHERE
	a.Step_ID = 100 
	AND ( 
		A.MaterialCode='121000102'
		OR	B.MaterialCode='121000102'
		OR	C.RM_MaterialCode='121000102'
		OR	Z.RM_MaterialCode='121000102'
		OR	D.MaterialCode='121000102'
	)